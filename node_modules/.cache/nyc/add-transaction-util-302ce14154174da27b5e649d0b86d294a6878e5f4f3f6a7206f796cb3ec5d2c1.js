function cov_saqjkuhj6(){var path="C:\\Users\\linju\\Desktop\\TP Y2S2\\DVOPS\\Assignment\\Part 2\\BookTrack_DevOps_Project\\utils\\add-transaction-util.js";var hash="7980d7b9fd2cebc7e24271ca1c46fb4b9e57faa7";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\linju\\Desktop\\TP Y2S2\\DVOPS\\Assignment\\Part 2\\BookTrack_DevOps_Project\\utils\\add-transaction-util.js",statementMap:{"0":{start:{line:1,column:13},end:{line:1,column:41}},"1":{start:{line:2,column:26},end:{line:2,column:68}},"2":{start:{line:5,column:63},end:{line:5,column:71}},"3":{start:{line:7,column:4},end:{line:49,column:5}},"4":{start:{line:9,column:21},end:{line:9,column:49}},"5":{start:{line:10,column:8},end:{line:12,column:9}},"6":{start:{line:11,column:12},end:{line:11,column:70}},"7":{start:{line:15,column:8},end:{line:17,column:9}},"8":{start:{line:16,column:12},end:{line:16,column:80}},"9":{start:{line:20,column:30},end:{line:20,column:50}},"10":{start:{line:21,column:30},end:{line:21,column:50}},"11":{start:{line:23,column:8},end:{line:25,column:9}},"12":{start:{line:24,column:12},end:{line:24,column:103}},"13":{start:{line:28,column:34},end:{line:31,column:10}},"14":{start:{line:33,column:8},end:{line:35,column:9}},"15":{start:{line:34,column:12},end:{line:34,column:100}},"16":{start:{line:38,column:31},end:{line:43,column:10}},"17":{start:{line:45,column:8},end:{line:45,column:36}},"18":{start:{line:46,column:8},end:{line:46,column:65}},"19":{start:{line:48,column:8},end:{line:48,column:86}},"20":{start:{line:52,column:0},end:{line:52,column:36}}},fnMap:{"0":{name:"addTransaction",decl:{start:{line:4,column:15},end:{line:4,column:29}},loc:{start:{line:4,column:40},end:{line:50,column:1}},line:4}},branchMap:{"0":{loc:{start:{line:10,column:8},end:{line:12,column:9}},type:"if",locations:[{start:{line:10,column:8},end:{line:12,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:10},"1":{loc:{start:{line:15,column:8},end:{line:17,column:9}},type:"if",locations:[{start:{line:15,column:8},end:{line:17,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:15},"2":{loc:{start:{line:23,column:8},end:{line:25,column:9}},type:"if",locations:[{start:{line:23,column:8},end:{line:25,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:23},"3":{loc:{start:{line:23,column:12},end:{line:23,column:76}},type:"binary-expr",locations:[{start:{line:23,column:12},end:{line:23,column:42}},{start:{line:23,column:46},end:{line:23,column:76}}],line:23},"4":{loc:{start:{line:33,column:8},end:{line:35,column:9}},type:"if",locations:[{start:{line:33,column:8},end:{line:35,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:33}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"7980d7b9fd2cebc7e24271ca1c46fb4b9e57faa7"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_saqjkuhj6=function(){return actualCoverage;};}return actualCoverage;}cov_saqjkuhj6();const Book=(cov_saqjkuhj6().s[0]++,require('../models/book.js'));const BorrowTransaction=(cov_saqjkuhj6().s[1]++,require('../models/borrow-transaction.js'));async function addTransaction(req,res){cov_saqjkuhj6().f[0]++;const{book_id,borrower_name,borrowDate,returnDate}=(cov_saqjkuhj6().s[2]++,req.body);cov_saqjkuhj6().s[3]++;try{// Validate book ID
const book=(cov_saqjkuhj6().s[4]++,await Book.findById(book_id));cov_saqjkuhj6().s[5]++;if(!book){cov_saqjkuhj6().b[0][0]++;cov_saqjkuhj6().s[6]++;return res.status(400).json({error:"Invalid book ID"});}else{cov_saqjkuhj6().b[0][1]++;}// Validate borrower name
cov_saqjkuhj6().s[7]++;if(!borrower_name){cov_saqjkuhj6().b[1][0]++;cov_saqjkuhj6().s[8]++;return res.status(400).json({error:"Borrower name is required"});}else{cov_saqjkuhj6().b[1][1]++;}// Validate dates
const borrowDateObj=(cov_saqjkuhj6().s[9]++,new Date(borrowDate));const returnDateObj=(cov_saqjkuhj6().s[10]++,new Date(returnDate));cov_saqjkuhj6().s[11]++;if((cov_saqjkuhj6().b[3][0]++,isNaN(borrowDateObj.getTime()))||(cov_saqjkuhj6().b[3][1]++,isNaN(returnDateObj.getTime()))){cov_saqjkuhj6().b[2][0]++;cov_saqjkuhj6().s[12]++;return res.status(400).json({error:"Invalid date format for borrowDate or returnDate"});}else{cov_saqjkuhj6().b[2][1]++;}// Check if the book is currently borrowed (e.g., an active transaction exists)
const activeTransaction=(cov_saqjkuhj6().s[13]++,await BorrowTransaction.findOne({book_id:book._id,returnDate:{$gte:new Date()}// Book is considered "borrowed" if returnDate is in the future
}));cov_saqjkuhj6().s[14]++;if(activeTransaction){cov_saqjkuhj6().b[4][0]++;cov_saqjkuhj6().s[15]++;return res.status(400).json({error:"This book is already borrowed by another user"});}else{cov_saqjkuhj6().b[4][1]++;}// Create new transaction if the book is available
const newTransaction=(cov_saqjkuhj6().s[16]++,new BorrowTransaction({book_id:book._id,borrower:{name:borrower_name},borrowDate:borrowDateObj,returnDate:returnDateObj}));cov_saqjkuhj6().s[17]++;await newTransaction.save();cov_saqjkuhj6().s[18]++;res.json({message:"Transaction added successfully!"});}catch(error){cov_saqjkuhj6().s[19]++;res.status(500).json({error:"Error saving transaction: "+error.message});}}cov_saqjkuhj6().s[20]++;module.exports={addTransaction};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3Zfc2Fxamt1aGo2IiwiYWN0dWFsQ292ZXJhZ2UiLCJCb29rIiwicyIsInJlcXVpcmUiLCJCb3Jyb3dUcmFuc2FjdGlvbiIsImFkZFRyYW5zYWN0aW9uIiwicmVxIiwicmVzIiwiZiIsImJvb2tfaWQiLCJib3Jyb3dlcl9uYW1lIiwiYm9ycm93RGF0ZSIsInJldHVybkRhdGUiLCJib2R5IiwiYm9vayIsImZpbmRCeUlkIiwiYiIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImJvcnJvd0RhdGVPYmoiLCJEYXRlIiwicmV0dXJuRGF0ZU9iaiIsImlzTmFOIiwiZ2V0VGltZSIsImFjdGl2ZVRyYW5zYWN0aW9uIiwiZmluZE9uZSIsIl9pZCIsIiRndGUiLCJuZXdUcmFuc2FjdGlvbiIsImJvcnJvd2VyIiwibmFtZSIsInNhdmUiLCJtZXNzYWdlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImFkZC10cmFuc2FjdGlvbi11dGlsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEJvb2sgPSByZXF1aXJlKCcuLi9tb2RlbHMvYm9vay5qcycpO1xyXG5jb25zdCBCb3Jyb3dUcmFuc2FjdGlvbiA9IHJlcXVpcmUoJy4uL21vZGVscy9ib3Jyb3ctdHJhbnNhY3Rpb24uanMnKTtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGFkZFRyYW5zYWN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICBjb25zdCB7IGJvb2tfaWQsIGJvcnJvd2VyX25hbWUsIGJvcnJvd0RhdGUsIHJldHVybkRhdGUgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy8gVmFsaWRhdGUgYm9vayBJRFxyXG4gICAgICAgIGNvbnN0IGJvb2sgPSBhd2FpdCBCb29rLmZpbmRCeUlkKGJvb2tfaWQpO1xyXG4gICAgICAgIGlmICghYm9vaykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJJbnZhbGlkIGJvb2sgSURcIiB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFZhbGlkYXRlIGJvcnJvd2VyIG5hbWVcclxuICAgICAgICBpZiAoIWJvcnJvd2VyX25hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IFwiQm9ycm93ZXIgbmFtZSBpcyByZXF1aXJlZFwiIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVmFsaWRhdGUgZGF0ZXNcclxuICAgICAgICBjb25zdCBib3Jyb3dEYXRlT2JqID0gbmV3IERhdGUoYm9ycm93RGF0ZSk7XHJcbiAgICAgICAgY29uc3QgcmV0dXJuRGF0ZU9iaiA9IG5ldyBEYXRlKHJldHVybkRhdGUpO1xyXG5cclxuICAgICAgICBpZiAoaXNOYU4oYm9ycm93RGF0ZU9iai5nZXRUaW1lKCkpIHx8IGlzTmFOKHJldHVybkRhdGVPYmouZ2V0VGltZSgpKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCJJbnZhbGlkIGRhdGUgZm9ybWF0IGZvciBib3Jyb3dEYXRlIG9yIHJldHVybkRhdGVcIiB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBib29rIGlzIGN1cnJlbnRseSBib3Jyb3dlZCAoZS5nLiwgYW4gYWN0aXZlIHRyYW5zYWN0aW9uIGV4aXN0cylcclxuICAgICAgICBjb25zdCBhY3RpdmVUcmFuc2FjdGlvbiA9IGF3YWl0IEJvcnJvd1RyYW5zYWN0aW9uLmZpbmRPbmUoe1xyXG4gICAgICAgICAgICBib29rX2lkOiBib29rLl9pZCxcclxuICAgICAgICAgICAgcmV0dXJuRGF0ZTogeyAkZ3RlOiBuZXcgRGF0ZSgpIH0gLy8gQm9vayBpcyBjb25zaWRlcmVkIFwiYm9ycm93ZWRcIiBpZiByZXR1cm5EYXRlIGlzIGluIHRoZSBmdXR1cmVcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKGFjdGl2ZVRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcIlRoaXMgYm9vayBpcyBhbHJlYWR5IGJvcnJvd2VkIGJ5IGFub3RoZXIgdXNlclwiIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIG5ldyB0cmFuc2FjdGlvbiBpZiB0aGUgYm9vayBpcyBhdmFpbGFibGVcclxuICAgICAgICBjb25zdCBuZXdUcmFuc2FjdGlvbiA9IG5ldyBCb3Jyb3dUcmFuc2FjdGlvbih7XHJcbiAgICAgICAgICAgIGJvb2tfaWQ6IGJvb2suX2lkLFxyXG4gICAgICAgICAgICBib3Jyb3dlcjogeyBuYW1lOiBib3Jyb3dlcl9uYW1lIH0sXHJcbiAgICAgICAgICAgIGJvcnJvd0RhdGU6IGJvcnJvd0RhdGVPYmosXHJcbiAgICAgICAgICAgIHJldHVybkRhdGU6IHJldHVybkRhdGVPYmosXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGF3YWl0IG5ld1RyYW5zYWN0aW9uLnNhdmUoKTtcclxuICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6IFwiVHJhbnNhY3Rpb24gYWRkZWQgc3VjY2Vzc2Z1bGx5IVwiIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBcIkVycm9yIHNhdmluZyB0cmFuc2FjdGlvbjogXCIgKyBlcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHsgYWRkVHJhbnNhY3Rpb24gfTtcclxuIl0sIm1hcHBpbmdzIjoibXZHQWVZO0FBQUFBLGFBQUEsU0FBQUEsQ0FBQSxTQUFBQyxjQUFBLFdBQUFBLGNBQUEsRUFBQUQsYUFBQSxHQWZaLEtBQU0sQ0FBQUUsSUFBSSxFQUFBRixhQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLG1CQUFtQixDQUFDLEVBQ3pDLEtBQU0sQ0FBQUMsaUJB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