function cov_pyocj0brs(){var path="C:\\Users\\linju\\Desktop\\TP Y2S2\\DVOPS\\Assignment\\Part 2\\BookTrack_DevOps_Project\\utils\\add-book-util.js";var hash="21fc974ff7ab393c27d16e5757551740e38175b5";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\linju\\Desktop\\TP Y2S2\\DVOPS\\Assignment\\Part 2\\BookTrack_DevOps_Project\\utils\\add-book-util.js",statementMap:{"0":{start:{line:2,column:13},end:{line:2,column:41}},"1":{start:{line:6,column:4},end:{line:50,column:5}},"2":{start:{line:8,column:64},end:{line:8,column:72}},"3":{start:{line:11,column:28},end:{line:11,column:62}},"4":{start:{line:14,column:31},end:{line:14,column:59}},"5":{start:{line:15,column:33},end:{line:15,column:92}},"6":{start:{line:15,column:60},end:{line:15,column:91}},"7":{start:{line:18,column:37},end:{line:18,column:63}},"8":{start:{line:19,column:8},end:{line:21,column:9}},"9":{start:{line:20,column:12},end:{line:20,column:67}},"10":{start:{line:24,column:29},end:{line:24,column:57}},"11":{start:{line:25,column:8},end:{line:27,column:9}},"12":{start:{line:26,column:12},end:{line:26,column:66}},"13":{start:{line:30,column:8},end:{line:32,column:9}},"14":{start:{line:31,column:12},end:{line:31,column:67}},"15":{start:{line:35,column:24},end:{line:42,column:10}},"16":{start:{line:45,column:8},end:{line:45,column:29}},"17":{start:{line:46,column:8},end:{line:46,column:70}},"18":{start:{line:48,column:8},end:{line:48,column:51}},"19":{start:{line:49,column:8},end:{line:49,column:84}},"20":{start:{line:54,column:0},end:{line:54,column:29}}},fnMap:{"0":{name:"addBook",decl:{start:{line:5,column:15},end:{line:5,column:22}},loc:{start:{line:5,column:33},end:{line:51,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:15,column:52},end:{line:15,column:53}},loc:{start:{line:15,column:60},end:{line:15,column:91}},line:15}},branchMap:{"0":{loc:{start:{line:19,column:8},end:{line:21,column:9}},type:"if",locations:[{start:{line:19,column:8},end:{line:21,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:19},"1":{loc:{start:{line:25,column:8},end:{line:27,column:9}},type:"if",locations:[{start:{line:25,column:8},end:{line:27,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:25},"2":{loc:{start:{line:30,column:8},end:{line:32,column:9}},type:"if",locations:[{start:{line:30,column:8},end:{line:32,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:30}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"21fc974ff7ab393c27d16e5757551740e38175b5"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_pyocj0brs=function(){return actualCoverage;};}return actualCoverage;}cov_pyocj0brs();// Import the Book model to interact with the database
const Book=(cov_pyocj0brs().s[0]++,require('../models/book.js'));// Define an asynchronous function to handle adding a new book
async function addBook(req,res){cov_pyocj0brs().f[0]++;cov_pyocj0brs().s[1]++;try{// Destructure the required book details from the request body
const{title,author,isbn,genre,availableCopies}=(cov_pyocj0brs().s[2]++,req.body);// Convert the uploaded file buffer to a Base64 encoded string for the image
const imageBase64=(cov_pyocj0brs().s[3]++,req.file.buffer.toString('base64'));// Fetch all existing titles, normalize them, and store in an array
const existingTitles=(cov_pyocj0brs().s[4]++,await Book.find({},'title'));const normalizedTitles=(cov_pyocj0brs().s[5]++,existingTitles.map(book=>{cov_pyocj0brs().f[1]++;cov_pyocj0brs().s[6]++;return book.title.toLowerCase().trim();}));// Check if the normalized input title exists in the array of normalized titles
const normalizedInputTitle=(cov_pyocj0brs().s[7]++,title.toLowerCase().trim());cov_pyocj0brs().s[8]++;if(normalizedTitles.includes(normalizedInputTitle)){cov_pyocj0brs().b[0][0]++;cov_pyocj0brs().s[9]++;return res.status(400).json({error:'title_exists'});}else{cov_pyocj0brs().b[0][1]++;}// Check for existing ISBN to prevent duplicate entries
const existingISBN=(cov_pyocj0brs().s[10]++,await Book.findOne({isbn}));cov_pyocj0brs().s[11]++;if(existingISBN){cov_pyocj0brs().b[1][0]++;cov_pyocj0brs().s[12]++;return res.status(400).json({error:'isbn_exists'});}else{cov_pyocj0brs().b[1][1]++;}// Ensure ISBN is numeric and has exactly 13 digits
cov_pyocj0brs().s[13]++;if(!/^\d{13}$/.test(isbn)){cov_pyocj0brs().b[2][0]++;cov_pyocj0brs().s[14]++;return res.status(400).json({error:'isbn_invalid'});}else{cov_pyocj0brs().b[2][1]++;}// Create a new instance of the Book model with the provided data
const newBook=(cov_pyocj0brs().s[15]++,new Book({title,author,isbn,genre,availableCopies,image:imageBase64// Store image as Base64 encoded string
}));// Save the new book instance to the database
cov_pyocj0brs().s[16]++;await newBook.save();cov_pyocj0brs().s[17]++;res.status(201).json({message:'Book added successfully!'});// Send success response
}catch(error){cov_pyocj0brs().s[18]++;console.error('Error adding book:',error);// Log any errors encountered
cov_pyocj0brs().s[19]++;res.status(500).json({error:'An error occurred while adding the book.'});// Send error response
}}// Export the addBook function to make it available in other parts of the application
cov_pyocj0brs().s[20]++;module.exports={addBook};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfcHlvY2owYnJzIiwiYWN0dWFsQ292ZXJhZ2UiLCJCb29rIiwicyIsInJlcXVpcmUiLCJhZGRCb29rIiwicmVxIiwicmVzIiwiZiIsInRpdGxlIiwiYXV0aG9yIiwiaXNibiIsImdlbnJlIiwiYXZhaWxhYmxlQ29waWVzIiwiYm9keSIsImltYWdlQmFzZTY0IiwiZmlsZSIsImJ1ZmZlciIsInRvU3RyaW5nIiwiZXhpc3RpbmdUaXRsZXMiLCJmaW5kIiwibm9ybWFsaXplZFRpdGxlcyIsIm1hcCIsImJvb2siLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJub3JtYWxpemVkSW5wdXRUaXRsZSIsImluY2x1ZGVzIiwiYiIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImV4aXN0aW5nSVNCTiIsImZpbmRPbmUiLCJ0ZXN0IiwibmV3Qm9vayIsImltYWdlIiwic2F2ZSIsIm1lc3NhZ2UiLCJjb25zb2xlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImFkZC1ib29rLXV0aWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gSW1wb3J0IHRoZSBCb29rIG1vZGVsIHRvIGludGVyYWN0IHdpdGggdGhlIGRhdGFiYXNlXHJcbmNvbnN0IEJvb2sgPSByZXF1aXJlKCcuLi9tb2RlbHMvYm9vay5qcycpO1xyXG5cclxuLy8gRGVmaW5lIGFuIGFzeW5jaHJvbm91cyBmdW5jdGlvbiB0byBoYW5kbGUgYWRkaW5nIGEgbmV3IGJvb2tcclxuYXN5bmMgZnVuY3Rpb24gYWRkQm9vayhyZXEsIHJlcykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICAvLyBEZXN0cnVjdHVyZSB0aGUgcmVxdWlyZWQgYm9vayBkZXRhaWxzIGZyb20gdGhlIHJlcXVlc3QgYm9keVxyXG4gICAgICAgIGNvbnN0IHsgdGl0bGUsIGF1dGhvciwgaXNibiwgZ2VucmUsIGF2YWlsYWJsZUNvcGllcyB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICAgIC8vIENvbnZlcnQgdGhlIHVwbG9hZGVkIGZpbGUgYnVmZmVyIHRvIGEgQmFzZTY0IGVuY29kZWQgc3RyaW5nIGZvciB0aGUgaW1hZ2VcclxuICAgICAgICBjb25zdCBpbWFnZUJhc2U2NCA9IHJlcS5maWxlLmJ1ZmZlci50b1N0cmluZygnYmFzZTY0Jyk7XHJcblxyXG4gICAgICAgIC8vIEZldGNoIGFsbCBleGlzdGluZyB0aXRsZXMsIG5vcm1hbGl6ZSB0aGVtLCBhbmQgc3RvcmUgaW4gYW4gYXJyYXlcclxuICAgICAgICBjb25zdCBleGlzdGluZ1RpdGxlcyA9IGF3YWl0IEJvb2suZmluZCh7fSwgJ3RpdGxlJyk7XHJcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZFRpdGxlcyA9IGV4aXN0aW5nVGl0bGVzLm1hcChib29rID0+IGJvb2sudGl0bGUudG9Mb3dlckNhc2UoKS50cmltKCkpO1xyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiB0aGUgbm9ybWFsaXplZCBpbnB1dCB0aXRsZSBleGlzdHMgaW4gdGhlIGFycmF5IG9mIG5vcm1hbGl6ZWQgdGl0bGVzXHJcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElucHV0VGl0bGUgPSB0aXRsZS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcclxuICAgICAgICBpZiAobm9ybWFsaXplZFRpdGxlcy5pbmNsdWRlcyhub3JtYWxpemVkSW5wdXRUaXRsZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICd0aXRsZV9leGlzdHMnIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIElTQk4gdG8gcHJldmVudCBkdXBsaWNhdGUgZW50cmllc1xyXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nSVNCTiA9IGF3YWl0IEJvb2suZmluZE9uZSh7IGlzYm4gfSk7XHJcbiAgICAgICAgaWYgKGV4aXN0aW5nSVNCTikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ2lzYm5fZXhpc3RzJyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEVuc3VyZSBJU0JOIGlzIG51bWVyaWMgYW5kIGhhcyBleGFjdGx5IDEzIGRpZ2l0c1xyXG4gICAgICAgIGlmICghL15cXGR7MTN9JC8udGVzdChpc2JuKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ2lzYm5faW52YWxpZCcgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIEJvb2sgbW9kZWwgd2l0aCB0aGUgcHJvdmlkZWQgZGF0YVxyXG4gICAgICAgIGNvbnN0IG5ld0Jvb2sgPSBuZXcgQm9vayh7XHJcbiAgICAgICAgICAgIHRpdGxlLFxyXG4gICAgICAgICAgICBhdXRob3IsXHJcbiAgICAgICAgICAgIGlzYm4sXHJcbiAgICAgICAgICAgIGdlbnJlLFxyXG4gICAgICAgICAgICBhdmFpbGFibGVDb3BpZXMsXHJcbiAgICAgICAgICAgIGltYWdlOiBpbWFnZUJhc2U2NCwgLy8gU3RvcmUgaW1hZ2UgYXMgQmFzZTY0IGVuY29kZWQgc3RyaW5nXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFNhdmUgdGhlIG5ldyBib29rIGluc3RhbmNlIHRvIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgIGF3YWl0IG5ld0Jvb2suc2F2ZSgpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHsgbWVzc2FnZTogJ0Jvb2sgYWRkZWQgc3VjY2Vzc2Z1bGx5IScgfSk7IC8vIFNlbmQgc3VjY2VzcyByZXNwb25zZVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBhZGRpbmcgYm9vazonLCBlcnJvcik7IC8vIExvZyBhbnkgZXJyb3JzIGVuY291bnRlcmVkXHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIGFkZGluZyB0aGUgYm9vay4nIH0pOyAvLyBTZW5kIGVycm9yIHJlc3BvbnNlXHJcbiAgICB9XHJcbn1cclxuXHJcbi8vIEV4cG9ydCB0aGUgYWRkQm9vayBmdW5jdGlvbiB0byBtYWtlIGl0IGF2YWlsYWJsZSBpbiBvdGhlciBwYXJ0cyBvZiB0aGUgYXBwbGljYXRpb25cclxubW9kdWxlLmV4cG9ydHMgPSB7IGFkZEJvb2sgfTtcclxuIl0sIm1hcHBpbmdzIjoiODdGQWVZO0FBQUFBLGFBQUEsU0FBQUEsQ0FBQSxTQUFBQyxjQUFBLFdBQUFBLGNBQUEsRUFBQUQsYUFBQSxHQWZaO0FBQ0EsS0FBTSxDQUFBRSxJQUFJLEVBQUFGLGFBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsRUFFekM7QUFDQSxjQUFlLENBQUFDLE9BQU9BLENBQUNDLEdBQUcsQ0FBRUMsR0FBRyxDQUFFLENBQUFQLGFBQUEsR0FBQVEsQ0FBQSxNQUFBUixhQUFBLEdBQUFHLENBQUEsTUFDN0IsR0FBSSxDQUNBO0FBQ0EsS0FBTSxDQUFFTSxLQUFLLENBQUVDLE1BQU0sQ0FBRUMsSUFBSSxDQUFFQyxLQUFLLENBQUVDLGVBQWdCLENBQUMsRUFBQWIsYUFBQSxHQUFBRyxDQUFBLE1BQUdHLEdBQUcsQ0FBQ1EsSUFBSSxFQUVoRTtBQUNBLEtBQU0sQ0FBQUMsV0FBVyxFQUFBZixhQUFBLEdBQUFHLENBQUEsTUFBR0csR0FBRyxDQUFDVSxJQUFJLENBQUNDLE1BQU0sQ0FBQ0MsUUFBUSxDQUFDLFFBQVEsQ0FBQyxFQUV0RDtBQUNBLEtBQU0sQ0FBQUMsY0FBYyxFQUFBbkIsYUFBQSxHQUFBRyxDQUFBLE1BQUcsS0FBTSxDQUFBRCxJQUFJLENBQUNrQixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUUsT0FBTyxDQUFDLEVBQ25ELEtBQU0sQ0FBQUMsZ0JBQWdCLEVBQUFyQixhQUFBLEdBQUFHLENBQUEsTUFBR2dCLGNBQWMsQ0FBQ0csR0FBRyxDQUFDQyxJQUFJLEVBQUksQ0FBQXZCLGFB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